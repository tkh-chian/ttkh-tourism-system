# TTKH旅游管理系统

一个完整的泰国旅游产品预订管理系统，支持商家、代理、用户和管理员四种角色。

## 🚀 快速开始

### 环境要求
- Node.js 16+
- MySQL 8.0+
- npm 或 yarn

### 安装步骤

1. **克隆项目**
```bash
git clone <repository-url>
cd ttkh-tourism-system
```

2. **初始化数据库**
```bash
cd backend
node init-simple.js
```

3. **启动后端服务器**
```bash
cd backend
node simple-server.js
```

4. **启动前端服务器**（新终端窗口）
```bash
cd frontend
npm start
```

### 🧪 自动化测试

运行完整的系统测试：
```bash
node run-tests.js
```

## 📋 测试账户

| 角色 | 邮箱 | 密码 | 说明 |
|------|------|------|------|
| 管理员 | admin@ttkh.com | admin123 | 系统管理员 |
| 商家 | merchant@test.com | 123456 | 测试商家账户 |
| 代理 | agent@test.com | 123456 | 测试代理账户 |
| 用户 | user@test.com | 123456 | 测试用户账户 |

## 🎯 核心功能测试流程

### 1. 用户注册登录测试
- ✅ 商家注册 → 管理员审核 → 登录成功
- ✅ 代理注册 → 管理员审核 → 登录成功
- ✅ 普通用户注册登录
- ✅ 管理员登录

### 2. 商家产品管理测试
- ✅ 商家登录后台
- ✅ 创建旅游产品（上传海报、PDF文件）
- ✅ 设置价格日历（批量设置价格和库存）
- ✅ 提交产品审核

### 3. 管理员审核测试
- ✅ 管理员登录
- ✅ 审核商家注册申请
- ✅ 审核产品发布申请
- ✅ 产品审核通过后在首页展示

### 4. 产品展示和下单测试
- ✅ 首页产品列表展示
- ✅ 产品详情页面（含日历价格库存展示）
- ✅ 库存展示规则：>9显示">9"，≤9显示实际数字
- ✅ 普通用户/代理选择日期下单
- ✅ 订单创建成功，库存自动扣减

### 5. 商家订单处理测试
- ✅ 商家查看订单列表
- ✅ 订单详情查看
- ✅ 订单状态管理（确认/拒绝/存档）
- ✅ 付款截图查看
- ✅ 返回PDF文件上传

## 🔧 技术架构

### 后端技术栈
- **框架**: Node.js + Express
- **数据库**: MySQL 8.0
- **认证**: JWT
- **文件处理**: Base64编码存储
- **API**: RESTful API设计

### 前端技术栈
- **框架**: React 18 + TypeScript
- **样式**: Tailwind CSS
- **路由**: React Router
- **状态管理**: Context API
- **HTTP客户端**: Axios

### 数据库设计
- **用户表**: 支持四种角色（customer, merchant, agent, admin）
- **产品表**: 中泰双语支持，Base64文件存储
- **价格日历表**: 按日期设置价格和库存
- **订单表**: 完整订单流程管理

## 📱 响应式设计

系统完全支持响应式设计：
- **桌面端**: 4列产品网格布局
- **平板端**: 2列产品网格布局  
- **手机端**: 1列产品网格布局

## 🌐 多语言支持

- **中文**: 系统默认语言
- **泰文**: 完整泰文界面支持
- **切换机制**: 顶部语言切换按钮，切换后整个页面内容都变为对应语言

## 📊 库存管理规则

- **库存>9**: 显示">9"
- **库存1-9**: 显示实际数字
- **库存=0**: 显示"售罄"
- **颜色编码**: 绿色(充足)/黄色(紧张)/红色(售罄)

## 🔐 权限控制

### 角色权限矩阵
| 功能 | 用户 | 代理 | 商家 | 管理员 |
|------|------|------|------|--------|
| 浏览产品 | ✅ | ✅ | ✅ | ✅ |
| 创建订单 | ✅ | ✅ | ❌ | ❌ |
| 产品管理 | ❌ | ❌ | ✅ | ✅ |
| 订单审核 | ❌ | ❌ | ✅ | ✅ |
| 用户审核 | ❌ | ❌ | ❌ | ✅ |

## 🚨 重要说明

### 支付方式
- **线下支付**: 系统不集成任何线上支付接口
- **确认机制**: 通过付款截图上传 + 商家确认
- **文件回传**: 商家上传返回PDF文件给客户

### 文件存储
- **存储方式**: Base64编码存储在数据库
- **支持格式**: 
  - 海报图片: JPG, PNG, GIF (最大20MB)
  - 行程PDF: PDF格式 (最大50MB)
  - 护照文件: JPG, PNG, PDF

### 数据持久化
- **永久保存**: 所有数据永久保存，不会自动删除
- **审计日志**: 完整的操作日志记录
- **数据导出**: 支持订单数据、访问数据批量导出

## 🐛 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 确认数据库配置信息正确

2. **前端编译错误**
   - 删除node_modules文件夹
   - 重新运行npm install

3. **文件上传失败**
   - 检查文件大小是否超限
   - 确认文件格式是否支持

### 日志查看
- **后端日志**: 控制台输出
- **前端日志**: 浏览器开发者工具
- **数据库日志**: MySQL错误日志

## 📞 技术支持

如遇到问题，请检查：
1. 环境要求是否满足
2. 数据库是否正确初始化
3. 端口是否被占用
4. 防火墙设置是否正确

## 🎉 测试完成确认

当您看到以下信息时，说明系统部署成功：

```
🎉 所有测试步骤完成！

📍 访问地址:
   前端: http://localhost:3000
   后端: http://localhost:3001

🧪 测试账户:
   管理员: admin@ttkh.com / admin123
   商家: merchant@test.com / 123456
   代理: agent@test.com / 123456
   用户: user@test.com / 123456
```

现在您可以在浏览器中访问 http://localhost:3000 开始测试系统的各项功能！